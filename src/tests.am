##
## tests.am
##
## Copyright (C) 2013 John C. Bollinger
##
## All rights reserved.
##

VALGRIND_COMMAND = G_SLICE=always-malloc G_DEBUG=gc-friendly libtool --mode=execute valgrind --tool=memcheck --leak-check=full --leak-resolution=high --read-var-info=yes --track-origins=yes --suppressions=$(top_srcdir)/misc/third_party_lib.supp
# --error-exitcode=<number>

compiled_tests = \
    $(testdir)/test_create \
    $(testdir)/test_create_block1 \
    $(testdir)/test_create_block2 \
    $(testdir)/test_get_block \
    $(testdir)/test_get_all_blocks \
    $(testdir)/test_block_create_frame1 \
    $(testdir)/test_block_create_frame2 \
    $(testdir)/test_block_get_frame \
    $(testdir)/test_block_get_all_frames \
    $(testdir)/test_container_create_loop1 \
    $(testdir)/test_container_create_loop2 \
    $(testdir)/test_container_get_category_loop \
    $(testdir)/test_container_get_item_loop \
    $(testdir)/test_container_get_all_loops \
    $(testdir)/test_loop_get_names \
    $(testdir)/test_value_create \
    $(testdir)/test_value_init_char \
    $(testdir)/test_value_copy_char \
    $(testdir)/test_value_init_numb \
    $(testdir)/test_value_autoinit_numb \
    $(testdir)/test_value_parse_numb \
    $(testdir)/test_list_elements \
    $(testdir)/test_table_elements \
    $(testdir)/test_value_clone \
    $(testdir)/test_packet_create \
    $(testdir)/test_packet_set_item
# cif_packet_remove_item
# cif_packet_get_item
#   - test normalization
#   - test value 
# cif_packet_get_names
# cif_container_get_value
#   - invalid name
#   - absent
#   - present in zero-packet loop
#   - present in single-packet loop
#   - present in multiple-packet loop
#   - NULL value pointer pointer
#   - non-NULL pointer to NULL value pointer
#   - non-NULL pointer to non-NULL value pointer
#   - child frames / parent blocks not read
# cif_container_set_value
#   - invalid name
#   - NULL value pointer (?)
#   - each value type
#   - not initially present
#   - initially in single-packet loop
#   - initially in multi-packet loop
#   - child frames / parent blocks not affected
# cif_container_remove_item
#   - item name invalid
#   - item not present
#   - present in multi-item loop
#   - present in single-item loop
# cif_loop_add_item
# cif_loop_add_packet
# cif_loop_get_packets
# cif_pktitr_close
# cif_pktitr_abort
# cif_pktitr_next_packet
# cif_pktitr_update_packet
# cif_pktitr_remove_packet
# cif_container_destroy
# cif_loop_destroy
# cif_parse
# cif_write
#
# Not sure how to test these portably, except incidentally via valgrinding
# the other tests:
# cif_value_clean
# cif_*_free

check_PROGRAMS = $(compiled_tests)

TESTS = \
  $(testdir)/link.test \
  $(compiled_tests)

XFAIL_TESTS =

# This should really be AM_TESTS_ENVIRONMENT in an Automake that supports it:
TESTS_ENVIRONMENT = \
  CIF_HEADER_DIR="$(top_srcdir)/src" \
  CIF_LA=libcif.la \
  testdir="$(testdir)" \
  CC="$(CC)" \
  CCLD="$(CCLD)" \
  LIBTOOL="$(LIBTOOL)"

EXTRA_DIST += $(testdir)/link.test $(testdir)/test.h

CLEANFILES += $(testdir)/linktest.c $(testdir)/linktest.lo $(testdir)/linktest

clean_local_targets += clean-local-lt_tests

clean-local-lt_tests:
	$(RM) -rf $(testdir)/.libs

