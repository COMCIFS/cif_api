<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>cif-api: Resource management with CIF API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="dox.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="resource_mgmt">Resource management with CIF API </a></h1><p>The core CIF API, being written in C, leaves basic responsibility for resource management in the hands of the application programmer. Nevertheless, the API is designed to make the resource management burden as light as reasonably possible. What follows is a discussion of many of the considerations and specific API features that relate to resource management.</p>
<h2><a class="anchor" id="basics">
Resource management basics</a></h2>
<p>For the most part, CIF API objects are created dynamically via functions having <code>_create</code> in their names (<code><a class="el" href="group__whole__cif__funcs.html#gafa7ee8ca1c1105dc398153a340570fee" title="Creates a new data block bearing the specified code in the specified CIF.">cif_create_block()</a></code>, for example). Each object type for which there is a creation function has one or more functions for releasing that object and all its internal state: </p>
<ul>
<li>Most types have a <code>cif_*_free</code>() function that cleans up objects of that type. These are the workhorse resource releasing functions. For objects that are handles on parts of a managed CIF, these functions release the handle without modifying the underlying managed CIF. </li>
<li>Most handle objects have a <code>cif_*_destroy</code>() function that removes the portion of the managed CIF represented by the handle. Inasmuch as the handle would be useless after such an operation is performed, these functions also clean up the handle object as if by calling the appropriate free function.</li>
</ul>
<p>Use of the type-specific resource release functions ensures that all internal state is correctly released. Application code must not pass CIF API objects to the C library's <code>free()</code> function, except as may be explicitly described elsewhere in the API documentation.</p>
<p>Except where otherwise specified, CIF API functions that return a pointer to the caller via a pointer pointer (as object creation functions in particular do) thereby assign responsibility for the returned pointer to the calling function. More generally, any function that allocates an object directly or indirectly bears initial responsibility for releasing that object. It must ensure the object is released before it returns, or else it must pass responsibility for doing so to another context (typically the caller's). Note, too, that API functions that accept a pointer pointer argument vary with respect to what they do with the value, if any, that the argument initially points to. Many of them simply overwrite it, which will result in a memory leak if the caller passes a pointer to the only pointer to a live object.</p>
<p>Except where otherwise specified (such as for the <code>cif_*_free</code>() and <code>cif_*_destroy</code>() functions), passing a pointer as a CIF API function argument does not transfer responsibility for the pointed-to object to the called function. Furthermore, API functions do not create aliases to their pointer arguments that would make it unsafe for the responsible function to clean them up at its sole discretion. Where necessary, API functions copy objects in order to avoid creating aliases to them. These characteristics are intended to minimize confusion about whether application code can or should release any particular CIF API object.</p>
<p>Some API functions accept or return general objects such as arrays or Unicode strings. For the most part, the same rules apply to such objects as to CIF API objects, but the API does not provide resource management functions for such objects. See specific function documentation for details. With respect to arrays in particular, consult function docs for information about responsibility for array elements, as distinguished from responsibility for the array itself.</p>
<p>It should be borne in mind that CIF API handle objects, such as those of types <code>cif_container_tp</code> and <code>cif_loop_tp</code> , are separate resources from the corresponding parts of managed CIFs. At any given time, for any given part of a managed CIF, there may be any number -- including zero -- of extant, valid handles. New handles can be obtained for existing managed CIF pieces, and handles can be released without affecting the underlying managed CIF. Destroying the underlying managed piece invalidates all outstanding handles, but releases only the handle, if any, by which the destruction was performed.</p>
<h2><a class="anchor" id="special">
Exceptions and special cases</a></h2>
<p>The CIF API provides a handful of functions having resource management relevance that do not fit the general pattern: </p>
<ul>
<li>Though it does not have "create" in its name, the <a class="el" href="group__cifio__funcs.html#gaa63c92a58e9b58d368b161bd0741d64c" title="Parses a CIF from the specified stream using the library&#39;s built-in parser.">cif_parse()</a> function operates as an object creation function when its last argument is a pointer to NULL. </li>
<li>The creation function for loop packet iterators is <a class="el" href="group__loop__funcs.html#gaaa75132e7ed5357aee886c1cd01a1af4" title="Creates an iterator over the packets in the specified loop.">cif_loop_get_packets()</a> . Its cleanup functions are <a class="el" href="group__pktitr__funcs.html#gac1e81229999fe79c718d9c82b2f27123" title="Finalizes any changes applied via the specified iterator and releases any resources...">cif_pktitr_close()</a> and <a class="el" href="group__pktitr__funcs.html#ga9eb5e98ce0d242782160967a07277041" title="If possible, reverts any changes applied via the provided iterator to its CIF, and...">cif_pktitr_abort()</a> . </li>
<li>The function <a class="el" href="group__value__funcs.html#gac6eb6d7ad6225498e56c89ee225c2c46" title="Frees any resources associated with the provided value object without freeing the...">cif_value_clean()</a> is unusual in that it releases internal resources held by its argument without releasing the argument itself (converting it to a kind of value that does not require dynamically-allocated internal resources). </li>
<li>There is only one handle object for each overall managed CIF (of type <code>cif_tp</code> ). There is therefore no function <code>cif_free()</code> ; use <code><a class="el" href="group__whole__cif__funcs.html#ga4781ccd52bdc70271b44e6648f3ea41a" title="Removes the specified managed CIF, releasing all resources it holds.">cif_destroy()</a></code> instead. </li>
<li>There is no creation function for transparent data type <code>cif_handler_tp</code> . </li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr/>
<p style="font-size: small">Copyright 2014, 2015 John C. Bollinger</p>

